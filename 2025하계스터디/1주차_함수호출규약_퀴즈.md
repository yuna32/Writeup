2025 하계스터디 시스템해킹 1주차: 함수 호출 규약 퀴즈
==========================

## Q1~3. 아래 코드를 컴파일 했을 때, 컴파일된 어셈블리 코드 중 (a), (b), (c)에 들어갈 것으로 가장 적절한 것을 고르시오.

![image](https://github.com/user-attachments/assets/64617846-d8a4-4e73-b9a8-5536efe3512d)

 `cdecl` 호출 규약 활용 문제다.

주어진 어셈블리 코드의 main 함수 부분을 보면 `sum(1, 2, 3)`을 호출하기 위해 인자를 스택에 push하는 부분이 
`(a), (b), (c)`로 표시되어 있다.

* sum 함수는 a1, a2, a3 세 개의 인자를 가진다.
* sum(1, 2, 3) 호출 시 a1=1`, `a2=2`, `a3=3이 된다.

cdecl 호출 규약에 따라 인자를 역순으로 push해야 하므로 스택에는 `a3` (값 3), `a2` (값 2), `a1` (값 1) 순서로 push되어야 한다.

따라서
* (a)는 `a3`에 해당하는 값 `3`을 push
* (b)는 `a2`에 해당하는 값 `2`를 push
* (c)는 `a1`에 해당하는 값 `1`을 push

그러므로 (a)에 들어갈 가장 적절한 코드는 push 3

**Q1의 정답: push 3**

#### 문제 2, 3 또한 같은 코드를 사용하므로 같이 답할 수 있다.

(b)에 들어갈 코드는 a2의 값인 2를 push하는 명령어인 **push 2**
(c)에 들어갈 코드는 a1의 값인 1을 push하는 명령어인 **push 1**



## Q4. 아래 코드를 컴파일 했을 때, 컴파일된 어셈블리 코드 중 (d)에 들어갈 것으로 가장 적절한 것을 고르시오.

코드 자체는 위의 문제들과 같은 코드를 사용하므로 생략한다.

우리는 이미 (a), (b), (c)에 각각 push 3, push 2, push 1이 들어간다는 것을 알고 있다.

문제는 (d)에 들어갈 가장 적절한 코드를 찾는 것

call 0x80483db <sum> 명령 다음이 (d)

* cdecl 호출 규약의 특징 중 하나는 **호출자(caller)가 인자 전달에 사용된 스택 공간을 정리해야 한다**는 뜻이다.
* sum 함수는 3개의 int 인자를 받는다. x86 아키텍처에서 int는 4바이트이다.

따라서 sum 함수는 스택에 총 3 * 4 = 12 바이트의 인자를 push한다.

call 명령이 실행된 후, sum 함수는 실행을 마치고 ret 명령으로 호출자(main)로 돌아온다. 이때 sum 함수는 스택을 정리하지 않는다. 따라서 main 함수가 직접 스택을 정리해야 한다.

스택을 정리하는 방법은 esp 레지스터에 인자의 총 크기만큼 더하는 것이다.
add esp, 12 (12바이트 = 3 * 4바이트)

10진수 12의 16진수 표현이 0xc이므로
**정답: add esp, 0xc**


## Q5~7. SYSV를 적용하여 아래 코드를 컴파일 했을 때, 컴파일된 어셈블리 코드 중 (a),(b), (c)에 들어갈 것으로 가장 적절한 것을 고르시오.

![image](https://github.com/user-attachments/assets/f5a0eb9c-a43f-4235-9d9d-02a64d4642b5)

주어진 c코드를 보면

main 함수에서 sum(1, 2, 3)을 호출
  * `a1 = 1`
  * `a2 = 2`
  * `a3 = 3`

sysv 호출 규약에 따라 
* `a1` (값 1)은 첫 번째 인자이므로 RDI 레지스터로 전달
* `a2` (값 2)는 두 번째 인자이므로 RSI 레지스터로 전달
* `a3` (값 3)은 세 번째 인자이므로 RDX 레지스터로 전달

이때 a의 모든 보기는 값 0x3을 대상으로 하고 있다. 이는 a3의 값이다.

(a)에 해당하는 곳에 a3의 값 3을 전달하는 명령어가 들어가야 한다면, a3가 전달되는 레지스터는 EDX이므로 **mov edx, 0x3**이 가장 적절하다.

그렇다면 나머지 (b), (c)는 자연스럽게 **mov esi, 0x2와 mov edi, 0x1**이 된다고 볼 수 있다.



